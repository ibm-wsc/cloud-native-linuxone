
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://ibm-wsc.github.io/cloud-native-linuxone/full-dev-pipeline/runpipeline/" rel="canonical"/>
<link href="../../images/pipelines-logo.png" rel="icon"/>
<meta content="mkdocs-1.2, mkdocs-material-7.1.7" name="generator"/>
<title>8. Configure Development Deployment - Cloud Native LinuxONE Workshop</title>
<link href="../../assets/stylesheets/main.ca7ac06f.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.f1a3b89f.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../css/print-site.css" rel="stylesheet"/>
<link href="../../css/print-site-material.css" rel="stylesheet"/>
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-174658170-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
</head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="preference" dir="ltr">
<script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#configure-petclinic-development-deployment-to-meet-your-organizations-requirements1">8. 
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Cloud Native LinuxONE Workshop" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Cloud Native LinuxONE Workshop">
<img alt="logo" src="../../images/pipelines-logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Cloud Native LinuxONE Workshop
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              8. Configure Development Deployment
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/ibm-wsc/cloud-native-linuxone/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Cloud Native LinuxONE Workshop" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Cloud Native LinuxONE Workshop">
<img alt="logo" src="../../images/pipelines-logo.png"/>
</a>
    Cloud Native LinuxONE Workshop
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/ibm-wsc/cloud-native-linuxone/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        1. Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../introduction/">
        2. Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../prerequisites/">
        3. Prerequisites
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
        4-5. Build and Deploy Pet Clinic
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="4-5. Build and Deploy Pet Clinic" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          4-5. Build and Deploy Pet Clinic
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../build-and-deploy/build_overview/">
        4. Build and Deploy Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../build-and-deploy/upandrunning/">
        5. PetClinic Up and Running
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
        6-8. Configure PetClinic's Pipeline
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="6-8. Configure PetClinic's Pipeline" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          6-8. Configure PetClinic's Pipeline
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../configure_overview/">
        6. Configure Pipeline Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../pipeline/">
        7. Configure Build and Test
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          8. Configure Development Deployment
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        8. Configure Development Deployment
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#manage-resource-across-environments-with-kustomize">8.1 
    Manage resource across environments with Kustomize
  </a>
<nav aria-label="Manage resource across environments with Kustomize" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#creating-custom-task-for-kustomize">8.1.1 
    Creating Custom Task for Kustomize
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#add-kustomize-task-to-pipeline">8.1.2 
    Add Kustomize Task to Pipeline
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#clean-old-petclinic-instances-at-the-beginning-of-a-run">8.2 
    Clean Old PetClinic Instances at the Beginning of a Run
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-deploy-task-to-deploy-dev">8.3 
    Update Deploy Task to deploy-dev
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#run-the-updated-pipeline">8.4 
    Run the Updated Pipeline
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">8.5 
    Summary
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
        9-12. Test and Promote Pet Clinic
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="9-12. Test and Promote Pet Clinic" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          9-12. Test and Promote Pet Clinic
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../application-promotion/promote_overview/">
        9. Test and Promote Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../application-promotion/promote/">
        10. Promoting Application
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../application-promotion/git/">
        11. Integrating Git
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../application-promotion/action/">
        12. CI/CD in Action
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
        13. Cleanup
        <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="13. Cleanup" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          13. Cleanup
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cleanup/full-cleanup/">
        13. Environment Cleanup
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../resources/">
        14. Other resources
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../proposechange/">
        15. Propose a change
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../print_page/">
        Print Site
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#manage-resource-across-environments-with-kustomize">8.1 
    Manage resource across environments with Kustomize
  </a>
<nav aria-label="Manage resource across environments with Kustomize" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#creating-custom-task-for-kustomize">8.1.1 
    Creating Custom Task for Kustomize
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#add-kustomize-task-to-pipeline">8.1.2 
    Add Kustomize Task to Pipeline
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#clean-old-petclinic-instances-at-the-beginning-of-a-run">8.2 
    Clean Old PetClinic Instances at the Beginning of a Run
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#update-deploy-task-to-deploy-dev">8.3 
    Update Deploy Task to deploy-dev
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#run-the-updated-pipeline">8.4 
    Run the Updated Pipeline
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#summary">8.5 
    Summary
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/ibm-wsc/cloud-native-linuxone/edit/main/docs/full-dev-pipeline/runpipeline.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="configure-petclinic-development-deployment-to-meet-your-organizations-requirements1"><span class="enumerate-heading-plugin">8.</span> Configure PetClinic Development Deployment to Meet your Organization's Requirements<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup><a class="headerlink" href="#configure-petclinic-development-deployment-to-meet-your-organizations-requirements1" title="Permanent link">¶</a></h1>
<h2 id="manage-resource-across-environments-with-kustomize"><span class="enumerate-heading-plugin">8.1</span> Manage resource across environments with Kustomize<a class="headerlink" href="#manage-resource-across-environments-with-kustomize" title="Permanent link">¶</a></h2>
<p><a href="https://kustomize.io" rel="noopener noreferrer" target="_blank">Kustomize</a> is a tool for customizing <abbr title="(k8s): an open-source system for automating deployment, scaling, and management of containerized applications.">Kubernetes</abbr> resource configuration.</p>
<div class="admonition note">
<p class="admonition-title">From the documentation overview</p>
<p>Kustomize traverses a <abbr title="(k8s): an open-source system for automating deployment, scaling, and management of containerized applications.">Kubernetes</abbr> manifest to add, remove or update configuration options without forking. It is available both as a standalone binary and as a native feature of kubectl. See the <a href="https://kubernetes.io/blog/2018/05/29/introducing-kustomize-template-free-configuration-customization-for-kubernetes/" rel="noopener noreferrer" target="_blank">Introducing Kustomize <abbr title="(k8s): an open-source system for automating deployment, scaling, and management of containerized applications.">Kubernetes</abbr> Blog Post</a> for a more in-depth overview of Kustomize and its purpose.</p>
</div>
<p>As part of doing things the "<abbr title="an application that takes full advantage of cloud capabilities due to a microservices based architecture that can be scaled up and down independently.">cloud native</abbr>" way you will be using Kustomize to manage resource changes across your <code>dev</code> and <code>staging</code> environments as well as injecting information from your pipeline (such as newly created <abbr title="application and all of its software dependencies packaged into a tarball that runs as a container using a runtime engine such as Docker or Podman.">container image</abbr> information with git commits) into your <abbr title="(k8s): an open-source system for automating deployment, scaling, and management of containerized applications.">Kubernetes</abbr> (<abbr title="(OpenShift Container Platform / OCP): an open source container application platform based on the Kubernetes container orchestrator for enterprise application development and deployment">OpenShift</abbr>) resources. </p>
<p>To see how you use Kustomize, see the Kustomize configuration in your GitHub code in the subdirectories of the <a href="https://github.com/ibm-wsc/spring-petclinic/tree/main/ocp-files" rel="noopener noreferrer" target="_blank">ocp-files directory</a>.</p>
<p>For more information on how kubectl (and oc through kubectl) integrates Kustomize, see the <a href="https://kubectl.docs.kubernetes.io/guides/introduction/kustomize/" rel="noopener noreferrer" target="_blank">kubectl documentation</a>.</p>
<h3 id="creating-custom-task-for-kustomize"><span class="enumerate-heading-plugin">8.1.1</span> Creating Custom <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> for Kustomize<a class="headerlink" href="#creating-custom-task-for-kustomize" title="Permanent link">¶</a></h3>
<p>Since there is no <abbr title="a Task scoped to the entire cluster instead of a single project.">ClusterTask</abbr> defined for Kustomize, you will create a custom task for this purpose. It will change into the Kustomize directory, run a Kustomize command on the directory, and then apply the files from the directory using the built-in Kustomize functionality of the oc command line tool (via kubectl's Kustomize support)</p>
<ol>
<li>
<p>Copy the <code>kustomize</code> task using the following definition (copy by clicking on the copy icon in the top right of the box below):</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tekton.dev/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Task</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kustomize</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">description</span><span class="p">:</span> <span class="p p-Indicator">&gt;-</span>
    <span class="no">This task runs commands against the cluster where the task run is being</span>
    <span class="no">executed.</span>

    <span class="no">Kustomize is a tool for Kubernetes native configuration management.  It</span>
    <span class="no">introduces a template-free way to customize application configuration that</span>
    <span class="no">simplifies the use of off-the-shelf applications.  Now, built into kubectl</span>
    <span class="no">as apply -k and oc as oc apply -k.</span>
  <span class="nt">params</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ocp-files</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The directory where the kustomization yaml file(s) reside in the git directory</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">KUSTOMIZE_DIR</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="p p-Indicator">-</span> <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">base</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">subdirectory of KUSTOMIZE_DIR used for extra configuration of current resources</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EDIT_SUDBDIR</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="p p-Indicator">-</span> <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">overlay/dev</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">subdirectory of KUSTOMIZE_DIR used for specifying resources for a specific release such as dev or staging</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RELEASE_SUBDIR</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="p p-Indicator">-</span> <span class="nt">default</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kustomize --help</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The Kustomize CLI command to run</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SCRIPT</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
  <span class="nt">steps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="s">'quay.io/gmoney23/kustomize-s390x:v4.1.2'</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kustomize</span>
    <span class="nt">resources</span><span class="p">:</span>
      <span class="nt">limits</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200m</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
      <span class="nt">requests</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200m</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
    <span class="nt">workingDir</span><span class="p">:</span> <span class="s">"$(workspaces.source.path)/$(params.KUSTOMIZE_DIR)/$(params.EDIT_SUDBDIR)"</span>
    <span class="nt">script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$(params.SCRIPT)</span>
  <span class="p p-Indicator">-</span> <span class="nt">image</span><span class="p">:</span> <span class="s">'image-registry.openshift-image-registry.svc:5000/openshift/cli:latest'</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apply-oc-files</span>
    <span class="nt">resources</span><span class="p">:</span>
      <span class="nt">limits</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200m</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
      <span class="nt">requests</span><span class="p">:</span>
        <span class="nt">cpu</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200m</span>
        <span class="nt">memory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200Mi</span>
    <span class="nt">script</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">oc apply -k "$(workspaces.source.path)/$(params.KUSTOMIZE_DIR)/$(params.RELEASE_SUBDIR)"</span>
  <span class="nt">workspaces</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">source</span>
    <span class="nt">description</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">The git source code</span>
</code></pre></div>
</li>
<li>
<p>Create the <code>kustomize</code> <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr></p>
<p>a. Click <code>Import YAML</code> to bring up the box where you can create <abbr title="(k8s): an open-source system for automating deployment, scaling, and management of containerized applications.">Kubernetes</abbr> resource definitions from yaml</p>
<p>b. Paste the <code>kustomize</code> <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> into the box</p>
<p>c. Scroll down and click <code>Create</code> to create the <code>kustomize</code> <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> </p>
<p><img alt="Create Kustomize Task" src="../../images/Part1/CreateKustomizeTask.png"/></p>
</li>
</ol>
<p>You should now see the created <code>kustomize</code> <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr>.</p>
<p><img alt="Back to Pipelines" src="../../images/Part1/BackToPipelines.png"/></p>
<p>Finally, navigate back to the <code>Pipelines</code> section of the <abbr title="(OpenShift Container Platform / OCP): an open source container application platform based on the Kubernetes container orchestrator for enterprise application development and deployment">OpenShift</abbr> <abbr title="user interface">UI</abbr> and go back to editing your pipeline.</p>
<h3 id="add-kustomize-task-to-pipeline"><span class="enumerate-heading-plugin">8.1.2</span> Add Kustomize <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> to Pipeline<a class="headerlink" href="#add-kustomize-task-to-pipeline" title="Permanent link">¶</a></h3>
<ol>
<li>
<p>Add a sequential task after <code>clean-image</code> and when you <code>Select Task</code> choose the <code>kustomize</code> task. </p>
<p><img alt="Add Kustomize task to Pipeline Dev" src="../../images/Part1/AddKustomizeTaskPipeline.png"/></p>
</li>
<li>
<p>Configure <code>kustomize</code> task</p>
<p>Since your initial deploy will be for the <code>dev</code> environment, the only values you need to change are the <code>Display Name</code> and the <code>SCRIPT</code> (copy and paste boxes below image):</p>
<p><img alt="Kustomize Configure 1" src="../../images/Part1/KustomizeDevChoices.png"/></p>
<p><strong>Display Name</strong></p>
<div class="highlight"><pre><span></span><code>kustomize-dev
</code></pre></div>
<p><strong>SCRIPT</strong></p>
<div class="highlight"><pre><span></span><code>kustomize edit <span class="nb">set</span> image spring-petclinic<span class="o">=</span><span class="k">$(</span>params.IMAGE_NAME<span class="k">)</span>-minimal:<span class="k">$(</span>params.COMMIT_SHA<span class="k">)</span>
</code></pre></div>
</li>
<li>
<p><code>Save</code> the pipeline</p>
</li>
<li>
<p>Add workspace to <code>kustomize-dev</code> task </p>
<ol>
<li><code>Save</code> the current pipeline edit and switch to <code>YAML</code> from pipeline menu.</li>
</ol>
<p><img alt="Switch to yaml" src="../../images/Part1/SwitchYaml.png"/></p>
<div class="admonition question">
<p class="admonition-title">Why are you editing yaml directly?</p>
<p><code>Workspaces</code> are more versatile than traditional <code>PipelineResources</code> which is why you are using them. However, as the transition to workspaces continues, the <abbr title="(OpenShift Container Platform / OCP): an open source container application platform based on the Kubernetes container orchestrator for enterprise application development and deployment">OpenShift</abbr> Pipeline Builder doesn't support editing the <code>Workspace</code> mapping from a pipeline to a task via the Builder <abbr title="user interface">UI</abbr> so you have to do it directly in the yaml for now.</p>
</div>
<ol>
<li>
<p>Find the <code>kustomize-dev</code> and add the following workspace definition:</p>
<div class="highlight"><pre><span></span><code>      <span class="nt">workspaces</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">source</span>
        <span class="nt">workspace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">workspace</span>
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">How can you easily find the <code>kustomize-dev</code> task and add the workspace definition?</p>
<p>You can click on the black yaml box and then use your find keyboard shortcut (<code>ctrl+f</code> for Windows / <code>command+f</code> for mac) to bring up a find textbox (labeled 1 in the image below). Then, you can search the following term by pasting it into the find textbox:
<div class="highlight"><pre><span></span><code>name: kustomize-dev
</code></pre></div>
Paste the workspace definition under the highlighted line as shown in the image below.</p>
</div>
</li>
</ol>
<p><img alt="Kustomize Dev Add Workspace" src="../../images/Part1/AddWorkspaceKustomizeDev.png"/></p>
<ol>
<li><code>Save</code> the update</li>
</ol>
<p><img alt="Save Pipeline Edit Yaml" src="../../images/Part1/PipelineUpdatedYaml.png"/></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>After the save message above appears you can then proceed to <code>Cancel</code> back to the pipeline menu.</p>
</div>
</li>
</ol>
<h2 id="clean-old-petclinic-instances-at-the-beginning-of-a-run"><span class="enumerate-heading-plugin">8.2</span> Clean Old PetClinic Instances at the Beginning of a Run<a class="headerlink" href="#clean-old-petclinic-instances-at-the-beginning-of-a-run" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>Go back to editing your pipeline via <code>Actions -&gt; Edit Pipeline</code></p>
<p><img alt="Actions Edit Pipeline" src="../../images/Part1/ActionsEditPipeline.png"/></p>
</li>
<li>
<p>Add a <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> named <code>cleanup-resources</code> sequentially at the beginning of the pipeline before <code>fetch-repository</code> (using the <code>openshift-client</code> <abbr title="a Task scoped to the entire cluster instead of a single project.">ClusterTask</abbr>).</p>
<p><img alt="add cleanup sequential" src="../../images/Part1/AddSequentialTask.png"/></p>
</li>
<li>
<p>Configure the task with the following parameters (copy and paste boxes below image for changes):</p>
<p><img alt="cleanup resources" src="../../images/Part1/CleanupResourcesTask.png"/></p>
<p><strong>Display Name</strong></p>
<div class="highlight"><pre><span></span><code>cleanup-resources
</code></pre></div>
<p><strong>SCRIPT</strong></p>
<div class="highlight"><pre><span></span><code>oc delete deployment,cm,svc,route -l <span class="nv">app</span><span class="o">=</span><span class="k">$(</span>params.APP_NAME<span class="k">)</span> --ignore-not-found
</code></pre></div>
<p>and an empty <code>ARGS</code> value.</p>
<div class="admonition warning">
<p class="admonition-title">No help please!</p>
<p>Make sure <code>help</code> is deleted from the <code>ARGS</code> section (it will be greyed out once deleted) or bad things will happen (i.e. the help screen will come up instead of the proper command running). </p>
</div>
</li>
</ol>
<h2 id="update-deploy-task-to-deploy-dev"><span class="enumerate-heading-plugin">8.3</span> Update Deploy <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> to deploy-dev<a class="headerlink" href="#update-deploy-task-to-deploy-dev" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>Click on the <code>deploy</code> <abbr title="collection of Steps that you define and arrange in a specific order of execution to build a Pipeline. It executes as a Pod on your Kubernetes cluster.">Task</abbr> at the end of the pipeline and change the following parameters to the corresponding values (copy and paste boxes below image):</p>
<p><img alt="Deploy Dev Task Completed" src="../../images/Part1/DeployDevCompleted.png"/></p>
<p><strong>Display Name</strong>
<div class="highlight"><pre><span></span><code>deploy-dev
</code></pre></div></p>
<p><strong>Script</strong>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="s2">"</span><span class="k">$(</span>params.GIT_MESSAGE<span class="k">)</span><span class="s2">"</span> <span class="o">&amp;&amp;</span> oc <span class="nv">$@</span>
</code></pre></div></p>
<p><strong>Last Arg</strong></p>
<p>From <code>deploy/$(params.APP_NAME)</code> to:</p>
<div class="highlight"><pre><span></span><code>deploy/spring-petclinic-dev
</code></pre></div>
</li>
<li>
<p><code>Save</code> your pipeline!</p>
</li>
</ol>
<h2 id="run-the-updated-pipeline"><span class="enumerate-heading-plugin">8.4</span> Run the Updated Pipeline<a class="headerlink" href="#run-the-updated-pipeline" title="Permanent link">¶</a></h2>
<ol>
<li>
<p>Go to <code>Actions</code> -&gt; <code>Start</code> in the right hand corner of the pipeline menu</p>
<p><img alt="Actions Start Pipeline" src="../../images/Part1/StartPipelineManually.png"/></p>
</li>
<li>
<p>Manually <abbr title="captures and processes events from an external source (webhook) and maps the incoming data to a set of predefined parameters via a TriggerTemplate to create a new PipelineRun.">trigger</abbr> a <code>PipelineRun</code> by accepting the default values and clicking on <code>Start</code>.</p>
<div class="admonition note">
<p class="admonition-title">Persistent Volume Claim Note</p>
<p>Please select a <code>PersistentVolumeClaim</code> if it is not already filled out for you to complete your pipeline. If it is already filled out for you then jump right to starting the pipeline.</p>
</div>
<p><img alt="Trigger Pipeline Manual" src="../../images/Part1/PipelineExampleManualParameters.png"/></p>
</li>
<li>
<p>Watch the results of your build pipeline run. It should complete successfully as in the pictures below.</p>
<div class="admonition info">
<p class="admonition-title">How long will your pipeline take to run?</p>
<p>The pipeline run may take anywhere from 10-25 minutes to complete depending on the current system load. You can see the progress of your build, as well as if any errors occur, via the <abbr title="user interface">UI</abbr>. Thus, by monitoring the <abbr title="user interface">UI</abbr>, you can make sure things are going as planned.</p>
</div>
<p><strong>Pipeline Run Success View Perspective:</strong></p>
<p><img alt="Pipeline Run View" src="../../images/Part1/PipelineRolloutRunView.png"/></p>
<div class="admonition success">
<p class="admonition-title">Pipeline Run Details View</p>
<p>In the pipeline run <code>Details</code> view, you can see the pipeline run succeeded with all tasks having a green check mark. Additionally, the pipeline run in the above screenshot was <code>Triggered By</code> a user versus an automated source such as an <abbr title="(EventListener) is a Kubernetes custom resource that allows users a declarative way to process incoming HTTP based events with JSON payloads.">event listener</abbr> watching for a GitHub push...</p>
</div>
<p><strong>Pipeline Run Success Logs Perspective:</strong></p>
<p><img alt="Pipeline Run Logs" src="../../images/Part1/PipelineRolloutLogsView.png"/></p>
<div class="admonition success">
<p class="admonition-title">Pipeline Run Logs View</p>
<p>From the pipeline run <code>Logs</code> view you can see that the pipeline run tasks all have green check marks and that this was a manual build (from the message in the log output of the final [<code>deploy-dev</code>] task).</p>
</div>
</li>
</ol>
<h2 id="summary"><span class="enumerate-heading-plugin">8.5</span> Summary <img alt="🌓" class="twemoji" src="https://twemoji.maxcdn.com/v/latest/svg/1f313.svg" title=":first_quarter_moon:"/><a class="headerlink" href="#summary" title="Permanent link">¶</a></h2>
<p>Congratulations! You successfully deployed your PetClinic application to your development environment with automated checks and configuration to meet your needs. This means that whenever your pipeline is triggered it will automatically spin up resources to build, test and deploy your application according to the specification you need to meet for your organization<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<div class="footnote">
<hr/>
<ol>
<li id="fn:1">
<p>For the purposes of this lab, you are fulfilling the requirements of a fictional organization. These requirements could change for your specific organization but would follow a similar pattern with different specifics. <a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 7. Configure Build and Test" class="md-footer__link md-footer__link--prev" href="../pipeline/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              7. Configure Build and Test
            </div>
</div>
</a>
<a aria-label="Next: 9. Test and Promote Overview" class="md-footer__link md-footer__link--next" href="../../application-promotion/promote_overview/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              9. Test and Promote Overview
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/ibm-wsc" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://hub.docker.com/u/s390x" rel="noopener" target="_blank" title="hub.docker.com">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.b0710199.min.js", "version": null}</script>
<script src="../../assets/javascripts/bundle.76f349be.min.js"></script>
<script src="../../js/print-site-instant-loading.js"></script>
<script src="../../js/print-site.js"></script>
</body>
</html>